<tool id="clipkit" name="ClipKIT is a fast and flexible alignment trimming tool that keeps phylogenetically informative sites and removes others." version="0.1.0" python_template_version="3.5">
    <requirements>
        <requirement type="package" version="1.3.0">clipkit</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[    
        clipkit $input1 -m ${mode_selector} -o $trimmed_output ${log} ${complement}
        #if $gaps
            --gaps ${gaps}
        #end if;
        #if $log
            &&
            mv ${trimmed_output}.log ${log_output}
        #end if;
         #if $complement
            &&
            mv ${trimmed_output}.complement ${complement_output}
        #end if;
        
    ]]></command>
    <inputs>
        <param name="input1" type="data" format="fasta,clustal,maf,xmfa,phylip,stockholm" multiple="false" label="Alignment file" optional="false" />
        <param name="mode_selector" type="select" label="Select trimming mode from the list">
            <option value="smart-gap">smart-gap</option>
            <option value="gappy">gappy</option>
            <option value="kpic">kpic</option>
            <option value="kpic-smart-gap">kpic-smart-gap</option>
            <option value="kpic-gappy">kpic-gappy</option>
            <option value="kpi">kpi</option>
            <option value="kpi-smart-gap">kpi-smart-gap</option>
            <option value="kpi-gappy">kpi-gappy</option>
        </param>
        <param name="gaps" type="float" optional="true" value="0.9" min="0.0" max="1.0" label="gappyness" help="Specify gappyness threshold (between 0 and 1). Default: 0.9" multiple="false"/>
        <param name="log" type="boolean" truevalue="--log" falsevalue="" checked="False" label="create a clipkit log" />
        <param name="complement" type="boolean" truevalue="--complement" falsevalue="" checked="False" label="create complement of the trimmed alignment" />
    </inputs>
    <outputs>
        <data name="trimmed_output" format="fasta" label="Trimmed alignment."/>
        <data name="log_output" format="txt" label="Clipkit log."/>
        <data name="complement_output" format="fasta" label="Clipkit complement."/>
    </outputs>
    <tests>
        <test>
            <param name="input1" value="simple.fa"/>
            <param name="mode_selector" value="smart-gap" />
            <param name="log" value="true" />
            <param name="gaps" value="0.9" />
            <output name="trimmed_output" file="simple.fa.clipkit"/>
            <output name="log_output" file="simple.fa.clipkit.log"/>
        </test>
        <test>
            <param name="input1" value="simple.fa"/>
            <param name="mode_selector" value="gappy" />
            <param name="log" value="false" />
            <param name="gaps" value="0.2" />
            <output name="trimmed_output" file="gappy.simple.fa.clipkit"/>
        </test>
        <test>
            <param name="input1" value="simple.fa"/>
            <param name="mode_selector" value="gappy" />
            <param name="log" value="true" />
            <param name="gaps" value="0.2" />
            <output name="trimmed_output" file="gappy.simple.fa.clipkit"/>
            <output name="log_output" file="gappy.simple.fa.clipkit.log"/>
        </test>
        <test>
            <param name="input1" value="simple.fa"/>
            <param name="mode_selector" value="kpi" />
            <param name="log" value="false" />
            <param name="complement" value="true" />
            <param name="gaps" value="0.9" />
            <output name="trimmed_output" file="kpi.simple.fa.clipkit"/>
            <output name="complement_output" file="kpi.simple.fa.clipkit.complement"/>
        </test>
    </tests>
    <help><![CDATA[
ClipKIT
Version: 1.3.0
Citation: Steenwyk et al. 2020, PLOS Biology. doi: 10.1371/journal.pbio.3001007
https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.3001007

ClipKIT trims multiple sequence alignments and maintains phylogenetically informative sites.

Usage: clipkit <input> [optional arguments]

required arguments:
  <input>                                     input file
                                              (must be the first argument)

optional arguments:
  -o, --output <output_file_name>             output file name 
                                              (default: input file named with '.clipkit' suffix)
  
  -m, --mode <smart-gap,                      trimming mode 
              gappy,                          (default: smart-gap)
              kpic,
              kpic-smart-gap,           
              kpic-gappy,                
              kpi,
              kpi-smart-gap,
              kpi-gappy>                      
  
  -g, --gaps <threshold of gaps>              specifies gaps threshold
                                              (default: 0.9)
  
  -if, --input_file_format <file_format>      specifies input file format
                                              (default: auto-detect)    
  
  -of, --output_file_format <file_format>     specifies output file format
                                              (default: same as input file format)
  
  -l, --log                                   creates a log file
                                              (input file named with '.log' suffix)
  
  -c, --complementary                         creates complementary alignment of trimmed sequences
                                              (input file named with '.log' suffix)
  
  -h, --help                                  help message
  -v, --version                               print version
  
  -------------------------------------
  | Detailed explanation of arguments | 
  -------------------------------------
  Modes
      smart-gap: dynamic determination of gaps threshold
      gappy: trim sites that are greater than the gaps threshold
      kpic: keeps parismony informative and constant sites
      kpic-smart-gap: a combination of kpic- and smart-gap-based trimming
      kpic-gappy: a combination of kpic- and gappy-based trimming
      kpi: keep only parsimony informative sites
      kpi-smart-gap: a combination of kpi- and smart-gap-based trimming
      kpi-gappy: a combination of kpi- and gappy-based trimming
  
  Gaps
      Positions with gappyness greater than threshold will be trimmed. 
      Must be between 0 and 1. (Default: 0.9). This argument is ignored
      when using the kpi and kpic mdoes of trimming as well as an 
      iteration of trimming that uses smart-gap.
  
  Input and output file formats
      Supported input and output files include:
      fasta, clustal, maf, mauve, phylip, phylip-sequential, 
      phylip-relaxed, and stockholm
  
  Log
      Creates a log file that summarizes the characteristics of each position.
      The log file has four columns.
      - Column 1 is the position in the alignment (starting at 1), 
      - Column 2 reports if the site was trimmed or kept (trim and keep, respectively),
      - Column 3 reports if the site is a parsimony informative site or not (PI and nPI, respectively), or
        a constant site or not (Const, nConst), or neither (nConst, nPI)
      - Column 4 reports the gappyness of the the position (number of gaps / entries in alignment)
  
  Complementary
      Creates an alignment file of only the trimmed sequences

    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubPhyKIT,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {PhyKIT},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/jlsteenwyk/clipkit},
}</citation>
    </citations>
</tool>